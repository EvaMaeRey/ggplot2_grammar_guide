---
title: "concision"
author: "Gina Reynolds"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "ninjutsu"]
    nature:
      highlightLines: yes
      ratio: '16:9'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
knitr::opts_chunk$set(fig.height = 6, out.width = "100%", comment = " ", cache = T, dpi = 300)
library(flipbookr)
library(tidyverse)
library(gapminder)
```


```{r xaringan-themer, include = FALSE, eval = F}
# library(xaringanthemer)


# xaringanthemer::write_xaringan_theme(text_font_size = ".75cm",
#                                      text_color = "darkblue")

xaringanthemer::mono_accent(
  base_color = "#43418A",
  header_font_google = google_font("Montserrat"),
  text_font_google   = google_font("Montserrat", "200", "200i"),
  code_font_google   = google_font("Droid Mono"),
  text_font_size = ".7cm",
  code_font_size = ".7cm")
  

# write_xaringan_theme(
#   extra_css = list(
#     ".box-right" = list(
#       "height" = "300px",
#       "width" = "300px",
#       "position" = "absolute",
#       "top" = "33%",
#       "left" = "55%"
#     )
#   )
# )

```

---

## In human language shorter is often better.

--

## "If I had more time I would have written a shorter letter"

--

## Tips:

- Avoid prepositional phrases:  the baker's daughter, not: the daughter of the baker




---

# DRY?

--

## Don't Repeat Yourself

---

## We've been intentionally verbose

--

## We have repeated ourselves...

--

## Training *your neural net* with lots of data/experience/practice

--

Lessons from AI: neural networks do better at new tasks when they have lots of data/experience/practice 

---

# But ...

```{r, eval = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap) +
  aes(y = lifeExp) +
  geom_point() +
  aes(color = continent) +
  labs(x = "GDP per Capita (US$)") +
  labs(y = "Life Expectancy")
```

---

# Can be ...

```{r, eval = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap, #<<
      y = lifeExp, #<<
      color = continent) + #<<
  geom_point() +
  labs(x = "GDP per Capita (US$)", #<<
       y = "Life Expectancy") #<<
```

---

###  Another quick note on style (not related to concision)

--

### Non-mainstream, but fully supported (ggplot2: Elegant Graphics for Data Analysis 2009, uses it)

```{r, eval = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap, #<<
      y = lifeExp, #<<
      color = continent) + #<<
  geom_point() 
```

---

### Mainstream, (ggplot2: Elegant Graphics for Data Analysis 2016 does **not** use + aes())

```{r, eval = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot(aes(x = gdpPercap, #<<
             y = lifeExp, #<<
             color = continent)) + #<<
  geom_point() 
```

--

### I personally prefer unnested, sequential declarations

--

### Some really bristle at it - it's likely to be unfamiliar - not the style of mainstream training resources.

---


# ggplot DRY strategies

---

# last_plot()

--

Add stuff to existing, full, plot to produce second version


---

# g1
# g2 <- g1 + facet_wrap(~ continent)

--

## Add stuff to existing plot to produce second version, save both as objects

---

# g1
# g1 %+% data2

--

## Changes out data with new pipe operator %+%


---

`r chunk_reveal("last_plot", break_type = "auto", width_code = "69%", width_output = "30%")`

```{r last_plot, include = F}
library(gapminder)

# Plot1
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap) +
  aes(y = lifeExp) +
  geom_point() +
  aes(color = continent) #BREAK

# Plot2
last_plot() +
  facet_wrap(~continent) +
  theme(legend.position = "none") #BREAK
```

---

`r chunk_reveal("object")`

```{r object, include = F}
library(gapminder)

# Plot1
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap) +
  aes(y = lifeExp) +
  geom_point() +
  aes(color = continent) ->
g1

# Plot2
g1 +
  facet_wrap(~continent) +
  theme() ->
g2
```

---

`r chunk_reveal("new_data")`

```{r new_data, include = F}
gapminder %>% 
  filter(year == 2002) %>%
  filter(continent == "Americas") %>% 
  ggplot() +
  aes(x = gdpPercap) +
  aes(y = lifeExp) +
  geom_point() +
  labs(title = "Americas") ->
g1

# Change out data with special pipe
g1 %+% 
  (gapminder %>% 
    filter(year == 2002) %>%
    filter(continent == "Europe")) +
  labs(title = "Europe")
```

---

# DRY part II

--

## writing functions

--

## writing packages (especially for themes)

--

### See end of [covariance walk-through](https://evamaerey.github.io/statistics/covariance_correlation.html)

---

Generative work:

- synthetic data

- generative art

- minimal examples

- hypothetical outcome plots

- conceptual work (flatten the curve)

---

# Generating synthetic data

- rnorm() - random normal
- runif() - sample from random uniform distribution
- sample() - sample from a vector
- sample_frac() - sample rows from a data frame (bootstrapping + hops)

---

`r chunk_reveal("gen_art", )`

```{r gen_art, include = F}
# where does randomization seed start
set.seed(128347)
# create a dataframe with input vectors
tibble(x = runif(200),
       y = runif(200),
       z = x + y) %>% 
  ggplot() +
  aes(x = x, y = y, color = z) +
  geom_point() +
  ggforce::geom_voronoi_tile(alpha = .8) +
  aes(fill = z) +
  scale_fill_viridis_c()
```


---

For creating a manageable example...

--

Creating a toy dataset

--

[d'Hondt/Jefferson seat allocation toy example](https://evamaerey.github.io/flipbooks/dhondt_jefferson_allocation/dhondt_jefferson_allocation#70)


---

Also, being able to generate some data in your software can be helpful for creating [minimal working examples](https://community.rstudio.com/t/faq-whats-a-reproducible-example-reprex-and-how-do-i-do-one/5219) for asking for help as on forums like stack overflow.

---

# Hypothetical outcome plots - hops

---

## Visualizing a confidence interval

---

`r chunk_reveal("conf_interval", break_type = 1)`

```{r conf_interval, include = F}
gapminder %>%  
  filter(year == 2002) %>%  
  filter(continent == "Europe") %>% 
  ggplot() +  
  aes(x = gdpPercap/1000) +  
  aes(y = lifeExp) +  
  geom_point(size = 3, alpha = .3) +
  geom_smooth(method = lm)
```


---

`r chunk_reveal("conf_interval_boot", break_type = 20)`

```{r conf_interval_boot, include = F}
gapminder %>%  
  filter(year == 2002) %>%  
  filter(continent == "Europe") %>% 
  sample_frac(1, replace = T) %>% 
  ggplot() +  
  aes(x = gdpPercap/1000) +  
  aes(y = lifeExp) +  
  geom_point(size = 3, alpha = .3) +
  geom_smooth(method = lm, se = F) +
  coord_cartesian(xlim = c(0,45), ylim = c(70,84))
```

---

# making a HOP with gganimate

---

`r chunk_reveal("hops")`

```{r hops, include = F}
gapminder %>%  
  filter(year == 2002) %>%  
  filter(continent == "Europe") %>% 
  crossing(trial = 1:20) %>% 
  # sample with replacement for each trial
  group_by(trial) %>% 
  sample_frac(frac = 1, replace = T) %>% 
  ggplot() +  
  aes(x = gdpPercap/1000) +  
  aes(y = lifeExp) +  
  facet_wrap(~trial) +
  geom_point(size = 3, alpha = .3) +
  geom_smooth(method = lm, se = F) +
  facet_null() +
  gganimate::transition_manual(frames = trial)
```


---

# caching work w/ knitr

```{r, eval = F}
knitr::opts_chunk$set(
  echo = F, eval = T,
  message = F, warning = F, 
  cache = T #<<
  )
```




---



```{css, eval = TRUE, echo = FALSE}
.remark-code{line-height: 1.5; font-size: 85%}
```