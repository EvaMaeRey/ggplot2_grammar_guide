---
title: "Mapping Data in R with ggplot2 and geom_sf()"
subtitle: "a 'flipbookr' tutorial"
author: "Gina Reynolds and Conner J. Surrency"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, hygge, ninjutsu]
    nature:
      ratio: 10:5
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, echo=F}
knitr::opts_chunk$set(fig.width = 12, message = FALSE, warning = FALSE, comment = "", cache = T, fig.retina = 3)
library(flipbookr)
```

# What Are We Doing?
--

- Here we will walk through the process of creating maps in with ggplot using geom_sf()
--

- This will include the packages required and how to code a map.
--

- We will be looking at data from two cases: Wetherspoon restaurants in UK, and life expectancy in europe


---

## Set-Up
--

We will need the following packages (and data) installed:  
--

- tidyverse
--

- rnaturalearth


---
#Example #1
--

We know the location of restaurants in the UK and the price of the empire burgur. 


The map we make will be a simple static map that shows those points.

---

`r chunk_reveal("wetherspoon")`

```{r wetherspoon, include = F}
library(tidyverse)
library(rnaturalearth)
library(readxl)
read_excel("wetherspoon.xlsx") ->
wetherspoon_raw

wetherspoon_raw %>%
  janitor::clean_names() ->
wetherspoon
```

---

`r chunk_reveal("wether", widths = c(49, 50))`


```{r wether, include = T, echo=F}
rnaturalearth::ne_countries(
  scale = "medium", returnclass = "sf") %>% 
  select(name, continent, geometry) %>% 
  filter(name == 'United Kingdom') -> 
uk

wetherspoon %>% 
  ggplot() + 
  ggplot2::geom_sf(data = uk,
                   fill = "linen") + 
  geom_point(
    aes(x = longitude, 
        y = latitude, 
        size = empire_state_burger,
        fill = empire_state_burger), 
    alpha = .6,
    color = "black",
    stroke = 1, # larger outline width
    shape = 21 # point with outline and fill
    ) + 
  scale_size(range = c(.5,15), guide = F) +
  scale_fill_viridis_c(begin = .2, end = 1) + 
  labs(fill = "Empire State Burger\nCost (pounds)") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  theme(axis.title = element_blank()) +
  theme(panel.background = 
          element_rect(fill = "ghostwhite"))
```





---
#Example #2
--

The second example will also draw its shapefiles from the rnaturalearth package. We will also use a dataset containing the defense expenditure of NATO member states. 

We will make a colored map that allows for easy visual comparison of spending levels. This type is called a choropleth map.

---


```{r, echo=T}
library(readxl)
nato_expenditure <- read_excel("nato_expenditure.xlsx")

nato_expenditure
```
---

```{r nato, include = FALSE, echo=F}
nato_names <- c("Albania", "Belgium", "Bulgaria", "Canada", "Croatia", "Czech Republic", "Denmark", "Estonia", "France", "Germany", "Greece", "Hungary",
                "Iceland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Montenegro", "Netherlands", "Norway", "Poland", "Portugal", "Romania", "Slovakia", "Slovenia", "Spain", "Turkey", "United Kingdom", "United States")

library(gapminder)
gapminder %>% 
  filter(year == 2002) %>% 
  rename(name = country) ->
gapminder_2002_prepped

rnaturalearth::ne_countries(
  scale = "medium", returnclass = "sf") %>%   
  select(name, pop_est, gdp_md_est, 
         continent, geometry) %>%
  filter(name %in% nato_names) %>% 
  left_join(gapminder_2002_prepped, by = "name") ->
  nato_countries

ggplot(data = nato_countries) + 
  ggplot2::geom_sf(data = nato_countries) + 
    aes(fill = lifeExp) +
    scale_fill_viridis_c(option = "magma", direction = -1) +
  ggplot2::coord_sf(xlim = c(-175, 47.5), 
           ylim = c(23, 85), 
           expand = FALSE) + 
  labs(title = "Life Expectancy, 2002", 
         subtitle = "NATO Member States", 
         fill = "Share of GDP (%)") + 
  theme_bw() +
  theme(plot.title = 
            element_text(hjust = 0.5)) + 
  theme(plot.subtitle = 
            element_text(hjust = 0.5))
```

`r chunk_reveal("nato", break_type = "auto")`


---

`r chunk_reveal("projections", break_type = "rotate", widths = c(59, 40))`


```{r projections, include = F}
rnaturalearth::ne_countries(
  scale = "medium", returnclass = "sf") ->
ne_countries

ggplot(data = ne_countries) + 
  ggplot2::geom_sf(data = ne_countries) + 
    aes(fill = pop_est) +
    scale_fill_viridis_c(option = "magma") +
  labs(title = "Defense Expenditure by Share of GDP (%)", 
         subtitle = "NATO Member States", 
         fill = "Share of GDP (%)") + 
  theme_bw() +
  theme(plot.title = 
            element_text(hjust = 0.5)) + 
  theme(plot.subtitle = 
            element_text(hjust = 0.5)) +
  coord_sf() + #ROTATE
  coord_sf(crs = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=merc") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=155 +lat_0=-90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=145 +lat_0=-90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=135 +lat_0=-90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=115 +lat_0=-50 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=115 +lat_0=-30 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=115 +lat_0=90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=0 +lon_0=90 +lat_0=90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=10 +lon_0=70 +lat_0=90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=40 +lon_0=15 +lat_0=90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=laea +y_0=50 +lon_0=0 +lat_0=90 +ellps=WGS84 +no_defs") + #ROTATE
  coord_sf(crs = "+proj=igh") + #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") + #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=77.5 +lon_0=-56 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=77.5 +lon_0=-36 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=77.5 +lon_0=-16 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=77.5 +lon_0=0 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=77.5 +lon_0=15 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=89.5 +lat_2=45.5 +lat_0=77.5 +lon_0=90 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=110 +lat_2=45.5 +lat_0=77.5 +lon_0=90 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE
  coord_sf(crs = "+proj=aea +lat_1=120 +lat_2=45.5 +lat_0=77.5 +lon_0=90 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") #ROTATE 
  coord_sf(crs = "+proj=stere +lat_0=-90") #ROTATE 
  coord_sf(crs = "+proj=moll") #ROTATE 
```

---



```{css, eval = TRUE, echo = F}
.remark-code{line-height: 1.5; font-size: 60%}
```





