---
title: "Facet"
author: "Gina Reynolds"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "ninjutsu"]
    nature:
      highlightLines: yes
      ratio: '16:9'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
knitr::opts_chunk$set(fig.height = 6, out.width = "100%", comment = " ", cache = T, dpi = 300)
library(flipbookr)
```


```{r, include=FALSE}
library(tidyverse)
library(gapminder)
```


---

name: facets

# Punctuation: Small multiples

Punctuation helps us break up language into digestible pieces. Breaking up visualization can also be helpful.  

Creating *small multiples* also known as *faceting* is a powerful way to make data more digestible; we can process the encoding in just one of the plots easily translate those encodings to the remaining plots.   In ggplot, small plots based on a categorical variable can be visualized side-by-side.  



---

`r chunk_reveal("facets", break_type = "rotate", widths = c(54, 45))`


```{r facets, eval = F, echo = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap / 1000) +
  aes(y = lifeExp) +
  geom_point() +
  aes(color = continent) +
  NULL + #ROTATE
  facet_wrap(vars(continent)) + #ROTATE
  facet_wrap(vars(continent), ncol = 2) + #ROTATE
  facet_wrap(vars(continent), nrow = 1) + #ROTATE
  facet_wrap(vars(continent), scales = "free_x") + #ROTATE
  facet_wrap(vars(continent), scales = "free_x") + #ROTATE
  facet_wrap(vars(continent), scales = "free") + #ROTATE
  facet_wrap(vars(continent), strip.position = "top") + #ROTATE
  facet_wrap(vars(continent), strip.position = "bottom") + #ROTATE
  facet_wrap(vars(continent), strip.position = "left") + #ROTATE
  facet_wrap(vars(continent), strip.position = "right") + #ROTATE
  facet_grid(continent ~ pop > 10000000) + #ROTATE
  facet_grid(continent ~ pop > 10000000, switch = "x") + # y also possible #ROTATE
  facet_grid(continent ~ pop > 10000000, switch = "both") + #ROTATE
  facet_grid(. ~ continent) + #ROTATE
  ggforce::facet_col(facets = vars(continent), scales = "free_y", space = "free", strip.position = "top") + #ROTATE
  ggforce::facet_col(facets = vars(continent), scales = "free_y", space = "free", strip.position = "left") + #ROTATE
  facet_grid(facets = continent ~ .) + #ROTATE
  facet_grid(rows = vars(continent)) + #ROTATE
  facet_grid(cols = vars(continent)) + #ROTATE
  facet_grid(vars(continent), vars(pop > 10000000)) + #ROTATE
  facet_wrap(vars(continent, pop > 10000000), scales = "free_y") + #ROTATE
  ggforce::facet_zoom(xlim = c(5,10), horizontal = FALSE) + #ROTATE
  ggforce::facet_zoom(xlim = c(20, 25), ylim = c(65, 80), horizontal = FALSE) + #ROTATE
  facet_null() # overrides any faceting #ROTATE
```



---

`r chunk_reveal("background")`

```{r background, include = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = gdpPercap / 1000) +
  aes(y = lifeExp) +
  geom_point(data = . %>% select(-continent), 
    color = "darkgrey") +
  geom_point(color = "magenta") +
  facet_wrap(~ continent) 
```

---

`r chunk_reveal("categorical_free", break_type = "rotate")`

```{r categorical_free, eval = F, echo = F}
ggplot(mpg, aes(drv, model)) +
  geom_point() +
  facet_grid(manufacturer ~ ., scales = "free", space = "free") + # no strip position argument #ROTATE
  ggforce::facet_col(facets = vars(manufacturer), scales = "free_y", space = "free", strip.position = "top") + #ROTATE
  ggforce::facet_col(facets = vars(manufacturer), scales = "free_y", space = "free", strip.position = "left") + #ROTATE
  theme(strip.text.y = element_text(angle = 0))
```


---


`r chunk_reveal("pyramid", widths = c(54, 45))`

```{r pyramid, include = F}
gapminder %>% 
  filter(year == 2002 | year == 2007) %>% 
  filter(continent == "Americas") %>% 
  mutate(year = factor(year)) %>% # as categorical
  # reorder by reverse size of mean life exp 
  mutate(country = reorder(country, -lifeExp, mean)) %>% 
  # pay attention to this weird prep step
  mutate(life_exp_mod = 
           ifelse(year == 2002, -lifeExp, lifeExp)) %>% 
  ggplot() +
  aes(x = life_exp_mod, y = country, fill = year) +
  geom_col() + 
  ggpol::facet_share(~ year, 
                     reverse_num = TRUE, 
                     scales = "free") + 
  theme(legend.position = "none") +
  labs(y = NULL) +
  scale_y_discrete()
```






---

`r chunk_reveal("matrix", widths = c(59, 40))`

```{r matrix, include = F}
set.seed(12345)
library(ggforce)
diamonds %>% 
  select(carat, table, price, clarity) %>% 
  sample_frac(.1) %>% 
  ggplot() +
  ggforce::facet_matrix(
    rows = vars(everything())
    ) +
  aes(x = .panel_x) + 
  aes(y = .panel_y) +
  # first geom layer 
  geom_point(alpha = 0.2) +
  # second geom layer
  ggforce::geom_autodensity() +
  # third geom layer 
  geom_density2d() +
  # overwrites above facet specification with new
  ggforce::facet_matrix( 
    rows = vars(everything()), 
     layer.lower = 1, # first geom layer
     layer.diag = c(1,2), # first, second geom layer
     layer.upper = 3, # third geom layer
     grid.y.diag = FALSE
    )
```


---


Next up is ['greetings'](themes.html) (themes are what greets the eye).


```{css, eval = TRUE, echo = F}
.remark-code{line-height: 1.5; font-size: 60%}
```

