---
title: "{ggplot2} and extensions geoms"
author: "Gina Reynolds"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "ninjutsu"]
    nature:
      highlightLines: yes
      ratio: '16:9'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
knitr::opts_chunk$set(fig.height = 6, out.width = "100%", comment = " ", cache = T, dpi = 300)
library(flipbookr)
library(tidyverse)
library(gapminder)
options(scipen = 10)
```


---

- ggplot2
- ggforce
- ggbump
- ggpointdensity
- ggrepel
- packcircles
- waffle


---


```{r prep_data, eval = T, echo = F}
gapminder %>% # data from package
  filter(year == 2002) -> # filtering
gapminder_2002 # saving subset object
gapminder_2002 %>% 
  filter(continent == "Europe") ->
gapminder_2002_europe  
gapminder %>% 
  filter(continent == "Europe") ->
gapminder_europe
gapminder %>% 
  select(country, continent) %>% 
  distinct() %>% 
  group_by(continent) %>% 
  summarise(country_count = n()) ->
continent_aggregate
```




---

# 'Nouns':  The geom_*() line up




---
class: inverse, center, middle
name: cc

# continous x and y

---


`r chunk_reveal("continuous_continuous_build")`


```{r continuous_continuous_build, eval = F, echo =F}
ggplot(data = gapminder_2002) +
  aes(x = gdpPercap/1000) +
  aes(y = lifeExp) +
  coord_cartesian(xlim = c(0,50), ylim = c(35,90)) +
  geom_point() +
  theme_minimal()
```




---

`r chunk_reveal("continuous_continuous", break_type= "rotate")`


```{r continuous_continuous, eval = F, echo =F}
ggplot(data = gapminder_2002) +
  aes(x = gdpPercap/1000) +
  aes(y = lifeExp) +
  coord_cartesian(xlim = c(0,50), ylim = c(35,90)) +
  geom_point() +
  geom_rug() + #ROTATE
  geom_tile(width = 3, height = 3, fill = "green", alpha = .25) + #ROTATE
  geom_segment(aes(xend = 0, yend = 40), alpha = .2) + #ROTATE
  geom_curve(aes(xend = 0, yend = 40), linetype = "dotted") + #ROTATE
  geom_rect(aes(xmin = 20, xmax = gdpPercap/1000, ymin = 40, ymax = lifeExp), alpha = .02, fill = "magenta", color = "grey") + #ROTATE
  geom_text(aes(label = country)) + #ROTATE
  geom_label(aes(label = country)) + #ROTATE
  stat_density_2d(aes(fill = ..density..), geom = "raster",  contour = FALSE, alpha = .5) +  #ROTATE
  geom_density2d() + #ROTATE
  ggalt::stat_bkde2d(bandwidth=c(0.5, 4), aes(fill = ..level..), geom = "polygon") + #ROTATE
  ggalt::geom_bkde2d(bandwidth=c(0.5, 4)) + #ROTATE
  geom_smooth() +  # #ROTATE
  geom_smooth(method = lm) + #ROTATE
  geom_hex(alpha = .5,color = "white") + #ROTATE
  geom_hex(bins = 12, alpha = .9, color = "white") + #ROTATE
  ggforce::geom_voronoi_segment() + #ROTATE
  ggforce::geom_voronoi_tile(fill = "green", color = "white", alpha = .5) + #ROTATE
  ggforce::geom_voronoi_tile(aes(fill = continent, group = -1L), color = "white", alpha = .5, normalize = TRUE) + #ROTATE
  ggforce::geom_voronoi_tile(aes(fill = continent, group = -1L), colour = 'black', max.radius = 3, alpha = .5) + #ROTATE
  ggforce::geom_delaunay_tile(fill = "magenta", alpha = 0.3, colour = 'black') + #ROTATE
  ggforce::geom_delaunay_segment2(aes(color = continent, group = -1L), size = 3, lineend = 'round') + #ROTATE
  ggforce::geom_bspline_closed(alpha = 0.5, fill = "cadetblue") + #ROTATE
  ggforce::geom_bspline_closed(alpha = 0.5, fill = "cadetblue") + #ROTATE
  ggforce::geom_diagonal(aes(xend = 20, yend = lifeExp - 3), color = "goldenrod4") + #ROTATE
  ggbump::geom_sigmoid(aes(group = country, xend = 20, yend = lifeExp - 3), color = "firebrick") + #ROTATE
  geom_path(color = "plum4") + #ROTATE
  geom_polygon(alpha = 0.5, fill = "plum4") + #ROTATE
  ggalt::geom_encircle(s_shape=0.5, expand=0.1, colour="purple") + #ROTATE
  ggalt::geom_encircle(aes(color = continent), s_shape=0.5, expand=0.1) + #ROTATE
  ggalt::geom_encircle(s_shape=1, expand=0.1, colour="purple") + #ROTATE
  ggalt::geom_encircle(aes(color = continent), s_shape=1, expand=0.1) + #ROTATE
  ggforce::geom_mark_hull() + #ROTATE
  ggforce::geom_mark_hull(concavity = 7) + #ROTATE
  ggforce::geom_mark_hull(aes(fill = continent)) + #ROTATE
  ggforce::geom_mark_hull(aes(fill = continent, filter = continent == "Europe")) + #ROTATE
  ggforce::geom_mark_circle() + #ROTATE
  ggforce::geom_mark_circle(aes(fill = continent)) + #ROTATE
  ggforce::geom_mark_ellipse(aes(fill = continent, filter = continent == "Europe")) + #ROTATE
  ggforce::geom_mark_rect() + #ROTATE
  ggforce::geom_mark_rect(aes(fill = continent)) + #ROTATE
  ggpointdensity::geom_pointdensity() + #ROTATE
  theme_minimal()
```

---

x and y dense

---

`r chunk_reveal("dense")`

```{r dense, include = F}
set.seed(2022)
tibble(my_x = rnorm(2000),
       my_y = my_x + rnorm(2000)) %>% 
  ggplot() +
  aes(x = my_x) +
  aes(y = my_y) +
  ggpointdensity::geom_pointdensity() +
  scale_color_viridis_c()
```



---

## Questions

- How is geom_tile() different from geom_point()? Look at the help.

- What aesthetics are required for geom_rect?

- How many geometric layers are in the final plot?

- Does order of the geom_*() statements matter to the end result?  How?



---
name: single_series

## Single series


---

`r chunk_reveal("time_series", break_type = "rotate")`

```{r time_series, include=F}
gapminder %>% 
  filter(country == "New Zealand") %>% 
  ggplot() +
  aes(x = year) +
  aes(y = pop * gdpPercap) +
  aes(group = country) +
  geom_point() +
  geom_col() + #ROTATE
  geom_segment(aes(xend = year, yend = 0)) + #ROTATE
  geom_segment(aes(xend = year, yend = 0), arrow = arrow()) + #ROTATE
  geom_line() + #ROTATE
  ggforce::geom_link2(aes(color = year, size = year, group = 1), lineend = 'round', alpha = .5) + #ROTATE
  geom_line(aes(color = year, group = 1)) + #ROTATE
  geom_area(alpha = .4, fill = "plum1", color = "plum1") + #ROTATE
  theme_minimal()
```




---

`r chunk_reveal("jagged", break_type = "rotate")`


```{r jagged, include=F}
set.seed(2022)
tibble(my_x = 1990:2010,
       my_y = rnorm(21)) %>% 
  ggplot() +
  aes(x = my_x) + 
  aes(y = my_y) +
  geom_point() + 
  aes(color = my_y) +
  geom_line() + #ROTATE
  geom_smooth() + #ROTATE
  ggforce::geom_link() + #ROTATE
  ggforce::geom_bspline() + #ROTATE
  ggforce::geom_bezier(aes(group = 1)) + #ROTATE 
  ggalt::geom_xspline(spline_shape = 0.4) + #ROTATE
  ggalt::geom_xspline(spline_shape = 0.8) + #ROTATE
  ggalt::geom_xspline(spline_shape = 0.1) + #ROTATE
  ggalt::geom_xspline(spline_shape = -1, size = 0.5) + #ROTATE
  ggforce::geom_link2(aes(size = my_y, group = 1), lineend = 'round', alpha = .5) + #ROTATE
  scale_color_viridis_c()
```


---

`r chunk_reveal("polar_bar")`

```{r polar_bar, include = F}
gapminder %>% 
  filter(continent == "Oceania") %>% 
  mutate(pop_millions = pop/1000000) %>% 
  arrange(-pop) %>% 
  ggplot() +
  aes(x = year) +
  aes(y = pop_millions) +
  geom_col(width = 4, position = "dodge") +
  coord_polar() +  
  scale_y_continuous(limits = c(-10, 25)) +
  scale_x_continuous(breaks = seq(1952, 2007, by = 5), 
                     limits = c(1950, 2010)) +
  aes(fill = country) +
  geom_text(data = . %>% filter(country == "Australia"),
            aes(label = year,
                y = pop_millions + 3),
            fontface = "bold",
            color = "navy") +
  theme_void() + 
  theme(legend.position = c(.8,.8)) +
  labs(fill = NULL)
```

---

`r chunk_reveal("pie_donut")`

```{r pie_donut, include = F}
gapminder %>%  
  filter(year == 2002) %>%  
  count(continent) %>%  
  mutate(text_pos_y = sum(n) - cumsum(n)) %>%  
  mutate(text_pos_y = (lag(text_pos_y,  
                           default = sum(n)) +  
                       text_pos_y) / 2) %>%  
  ggplot() +  
  aes(x = 1) +
  aes(y = n) +
  geom_col(width = 2) +
  aes(fill = continent) +
  geom_text(aes(label = continent, 
                y = text_pos_y, 
                x = 2.3 + c(.3,.1,.2,.3,0)),  
            color = "navy",
            fontface = "bold") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_x_continuous(limits = c(-3, 2.8)) +
  theme(legend.position = "none")
```


---

`r chunk_reveal("circle_pack")`

```{r circle_pack, include = F}
gapminder %>% 
  filter(continent == "Americas") %>% 
  filter(year == 2002) %>% 
  select(country, pop) ->
prep

packcircles::circleProgressiveLayout(prep$pop,
                                         sizetype = 'area') ->
pack
  
pack %>% 
  packcircles::circleLayoutVertices(npoints = 50) ->
circle_outlines
  
circle_outlines %>% 
  ggplot() + 
  aes(x = x, y = y) +
  geom_polygon(colour = "black", alpha = 0.6) +
  aes(group = id) + 
  aes(fill = factor(id)) +
  geom_text(data = cbind(prep, pack), 
            aes(x, y, size = pop, label = country,
                group = NULL, fill = NULL)) +
  theme(legend.position = "none") +
  coord_equal()
```

---

`r chunk_reveal("treemapify")`

```{r treemapify, include = F}
gapminder %>% 
  filter(continent == "Americas") %>% 
  filter(year == 2002) %>% 
  mutate(pop_millions = pop/1000000) %>% 
  ggplot() + 
  aes(fill = pop_millions, area = pop_millions) +
  treemapify::geom_treemap() +
  treemapify::geom_treemap_text(aes(label = country),
    fontface = "italic", 
                                colour = "white", 
                                place = "topleft",
                                grow = F) +
  scale_fill_viridis_c(trans = "log10", begin = .2, option = "inferno",
                       end = .7, breaks = c(1, 3, 10, 30, 100))
```



---
class: middle, center, inverse

# Singe value per category


---

`r chunk_reveal("single_value", break_type = "rotate")`

```{r single_value, include=F}
gapminder %>% 
  filter(year == 2002) %>% 
  filter(continent == "Europe") %>% 
  ggplot() +
  aes(x = lifeExp) +
  aes(y = reorder(country, lifeExp)) +
  geom_point() +
  geom_col() + #ROTATE
  geom_segment(aes(xend = 0, yend = country)) + #ROTATE
  geom_hline(aes(yintercept = country), linetype = "dotted") + #ROTATE
  theme_minimal()
```



---

`r chunk_reveal("waffle")`

```{r waffle, include = F}
gapminder %>%
  filter(year == 2002) %>% 
  count(continent) %>% 
  ggplot() +
  waffle::geom_waffle(aes(fill = continent, values = n),
    n_rows = 20, size = 0.33, colour = "white", flip = T) + 
  coord_equal() +
  facet_wrap(~continent, strip.position = "bottom") +
  theme_void() +
  theme(legend.position = "none")
```

---
class: inverse, center, middle
name: mult_series


## a few series


---

`r chunk_reveal("time_series_multi", break_type = "rotate")`

```{r time_series_multi, include=F}
gapminder %>% 
  filter(continent == "Oceania") %>% 
  mutate(gdp = pop * gdpPercap) %>% 
  ggplot() +
  aes(x = year) +
  aes(y = gdp) +
  geom_point() +
  geom_line(aes(linetype = country, color = country)) + #ROTATE
  ggforce::geom_bspline(aes(linetype = country)) + #ROTATE
  geom_col(aes(fill = country), position = "dodge", alpha = .4) + #ROTATE
  geom_col(aes(fill = country), alpha = .4) + #ROTATE
  geom_area(aes(fill = country), alpha = .4) + #ROTATE
  theme_minimal()
```

---






---
class: inverse, center, middle

# Many series



---



`r chunk_reveal("aes_group")`


```{r aes_group, eval = F, echo = F}
gapminder %>% 
  filter(continent %in% c("Americas", "Oceania")) %>% 
  ggplot() +
  aes(x = year) +
  aes(y = lifeExp) +
  geom_point(color = "grey60") +
  geom_line(color = "grey60") +
  aes(color = country) +
  scale_color_discrete(guide = F) +
  aes(color = NULL) +
  aes(group = country) +
  geom_point(data = . %>% # using global data
               filter(country %in% # filtering to 
                       c("New Zealand","Chile")), # NZ and  Chile
             color = "plum4",
             size = 4) +
  geom_line(data = . %>% 
              filter(country %in% 
                       c("New Zealand","Chile")), 
            color = "plum4",
            size = 2) +
  geom_text(data = . %>% 
              filter(country %in% 
                       c("New Zealand","Chile")) %>% 
              group_by(country) %>% 
              slice(3),
            aes(label = country),
            nudge_y = 2, hjust = .7, 
            color = "plum4", size = 5, 
            fontface = "bold")
```

---

`r chunk_reveal("difference_ribbon")`


```{r difference_ribbon, eval = F, echo = F}
gapminder %>%
  filter(continent == "Oceania") %>% 
  mutate(pop_millions = pop/1000000) ->
gm_oceania

gm_oceania %>%
  select(-gdpPercap, -lifeExp, - pop) %>% 
  pivot_wider(names_from = country,
              values_from = pop_millions) ->
gm_oceania_pop_millions_wide
  
gm_oceania %>% # global data
  ggplot() +
  aes(x = year) +
  aes(y = pop_millions) +
  geom_line(aes(linetype = country),
            color = "plum4") +
  geom_ribbon(data = gm_oceania_pop_millions_wide, # local data
              aes(ymin = `New Zealand`, # poorly named var like this one has space
                  ymax = Australia,     # must be surrounded by back ticks
                  y = NULL), # without this geom ribbon is wondering about y equals year
              fill = "plum4",
              alpha = .1) +
  scale_y_continuous(limits = c(0, 22))
```

---

`r chunk_reveal("growth")`


```{r growth, eval = F, echo = F}
gapminder %>%
  filter(continent == "Europe") %>% 
  filter(year %in% c(1972, 2002)) %>% 
  mutate(country = reorder(country, lifeExp, mean)) ->
gap_72_02_europe

gap_72_02_europe %>% 
  select(-gdpPercap, -pop) %>% 
  pivot_wider(names_from = year,
              values_from = lifeExp) ->
gap_72_02_europe_wide

ggplot(data = gap_72_02_europe) +
  aes(x = lifeExp) +
  aes(y = country) +
  geom_point() +
  aes(color = factor(year)) +
  geom_segment(data = gap_72_02_europe_wide,
                 aes(x = `1972`, # poorly named columns ie starting w number
                     xend = `2002`, # need to be surouned by backtick
                     yend = country),
               color = "plum3",
               size = 1.5) +
  geom_point(size = 4) + # point layer above not really needed - just for showing logic
  scale_color_manual(values = c("plum3", "plum4")) +
  theme(legend.position = c(.15,.85)) +
  labs(color = NULL, y = NULL)
```




---
name: group

## The group aesthetic and geometric objects


---

Using geom_line(), you can use many of the same aesthetics as before as well as one special aesthetic: `group`.

> Lines and paths fall somewhere in between: each overall line is composed of a set of straight segments, but each segment represents two points. --- Hadley Wickham


Group is like a declaration that instead of plotting the entire data set all together, instead you will plot many small data sets, each defined by the categorical variable "mapped" to `group`.  

Let's see how this works with the following example. 

---
name: many_series
class: inverse, middle, center


# Many series


---

The geometric object `line` connects all points as it moves along the x axis.  If a group is not defined, the geom_line is hard to interpret, as seen before group is added.  

We also see that mapping discrete data to the color or linetype aesthetics has a similar effect to declaring that there are groups in the data. 

Another thing we observe in the last addition to the last plot is adding an additional geometric layer.  The point layer, because it follows the line layer, appears on top of the line layer.  





---

`r chunk_reveal("time_series_heat", break_type = "auto")`

```{r time_series_heat, include=F}
gapminder %>% 
  filter(continent == "Europe") %>% 
  ggplot() +
  aes(x = factor(year)) +
  aes(y = country) +
  geom_tile(color = "grey80") +
  aes(fill = lifeExp) +
  scale_fill_viridis_c(option = "magma")
```

---

# ranks of a series

---

`r chunk_reveal("time_series_bump", break_type = "auto")`

```{r time_series_bump, include=F}
gapminder %>% 
  filter(country %in% c("Austria", "Belgium", 
                        "Norway", "Netherlands",
                        "Spain", "Italy","France")) %>%
  filter(year > 1980) %>% 
  group_by(year) %>% 
  arrange(lifeExp) %>% 
  mutate(rank_life_exp = 1:n()) %>% 
  ungroup() %>% 
  ggplot() +
  aes(x = year) +
  aes(y = rank_life_exp) +
  geom_point(size = 6) +
  aes(color = country) +
  ggbump::geom_bump(size = 2, smooth = 8) +
  scale_x_continuous(limits = c(1970, 2020),
                     breaks = seq(1982, 2007, 
                                  by = 5)) +
  geom_text(data = . %>% 
              filter(year == min(year)),
            aes(x = year - 2.5, label = country), 
            size = 5, hjust = 1) +
  geom_text(data = . %>% 
              filter(year == max(year)),
            aes(x = year + 2.5, label = country), 
            size = 5, hjust = 0) +
  scale_color_manual(values = paletteer::paletteer_d("basetheme::brutal", 7)) +
  theme_minimal() +
  theme(legend.position = "none")
```

---

`r chunk_reveal("time_series_bump_line", break_type = 1)`

```{r time_series_bump_line, include=F}
gapminder %>% 
  filter(country %in% c("Austria", "Belgium", 
                        "Norway", "Netherlands",
                        "Spain", "Italy","France")) %>%
  filter(year > 1980) %>% 
  group_by(year) %>% 
  arrange(lifeExp) %>% 
  mutate(rank_life_exp = 1:n()) %>% 
  ungroup() %>% 
  ggplot() +
  aes(x = year) +
  aes(y = rank_life_exp) +
  aes(color = country) +
  geom_line(size = 2, smooth = 8) + #<<
  geom_point(size = 6, shape = 21, fill = "white", stroke = 2) + #<<
  scale_x_continuous(limits = c(1970, 2020),
                     breaks = seq(1982, 2007, 
                                  by = 5)) +
  geom_text(data = . %>% 
              filter(year == min(year)),
            aes(x = year - 2.5, label = country), 
            size = 5, hjust = 1) +
  geom_text(data = . %>% 
              filter(year == max(year)),
            aes(x = year + 2.5, label = country), 
            size = 5, hjust = 0) +
  scale_color_manual(values = paletteer::paletteer_d("basetheme::brutal", 7)) +
  theme_minimal() +
  theme(legend.position = "none")
```


---

`r chunk_reveal("slope_plot")`

```{r slope_plot, include=F}
gapminder %>% 
  filter(country %in% c("Belgium", 
                        "Norway", 
                        "Spain")) %>%
  filter(year > 1990) %>% 
  ggplot() +
  aes(x = year) +
  aes(y = lifeExp) +
  aes(color = country) +
  geom_line(size = 2, smooth = 8) + 
  geom_label(aes(label = round(lifeExp, 1)),
    color = "darkgrey",
    stroke = "red",
    check_overlap = T) + 
  scale_x_continuous(limits = c(1985, 2012),
                     breaks = seq(1992, 2007, 
                                  by = 5)) +
  geom_text(data = . %>% 
              filter(year == min(year)),
            aes(x = year - 1.5, label = country), 
            size = 5, hjust = 1) +
  geom_text(data = . %>% 
              filter(year == max(year)),
            aes(x = year + 1.5, label = country), 
            size = 5, hjust = 0) +
  scale_color_manual(values = 
                       paletteer::paletteer_d("basetheme::brutal", 7)) +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank()) +
  theme(panel.grid.minor.y = element_blank()) +
  theme(panel.grid.minor.x = element_blank()) +
  theme(panel.grid.major.x = element_blank()) +
  theme(axis.text.y = element_blank()) +
  theme(axis.ticks.y = element_blank()) +
  theme(legend.position = "none") +
  labs(x = NULL, y = NULL)
```


---

[Racing bar chart](https://evamaerey.github.io/flipbooks/racing_bars/racing_barcharts.html#34) is concerned with ranks and values.


---

## Questions

geom_area() is a special case of what other geom_*()?  Use the help to answer this question. 

---

Geoms is a long section consider because there are many geoms. Consider taking the [overview track](#local).


---
name: c

# Continuous Univariate

---

`r chunk_reveal("univariate_continuous", break_type = "rotate")`


```{r, univariate_continuous, eval = F, echo = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = lifeExp) +
  theme_minimal() +
  geom_rug(col = "darkgrey") +
  geom_histogram(alpha = .5, fill = "cadetblue") + #ROTATE
  geom_freqpoly(linetype = "dashed") + #ROTATE
  geom_dotplot(fill = "blue", alpha = .5) + #ROTATE
  geom_dotplot(binwidth = "dotdensity", alpha = .5) + #ROTATE
  geom_histogram(col = "black", fill = "maroon4", alpha = .4, aes(y = ..density..)) + #ROTATE
  geom_density(linetype = "dotted", adjust = 1/4, size = 1.25) + #ROTATE
  geom_density(linetype = "dashed", adjust = 1/2, size = 1.25) + #ROTATE
  ggalt::geom_bkde(alpha = 0.3 ) + #ROTATE
  ggalt::geom_bkde(alpha = 0.3, bandwidth = .25, aes(fill = continent)) #ROTATE
```


---



---
name: c

# Continuous - Discrete via facetting

---

`r chunk_reveal("geom_discrete_continuous_facet", break_type = "rotate")`


```{r, geom_discrete_continuous_facet, eval = F, echo = F}
gapminder %>% 
  filter(year == 2002) %>% 
  ggplot() +
  aes(x = lifeExp) +
  theme_minimal() +
  geom_rug(col = "darkgrey") +
  geom_histogram(alpha = .5, fill = "cadetblue") + #ROTATE
  geom_freqpoly(linetype = "dashed") + #ROTATE
  geom_dotplot(fill = "blue", alpha = .5) + #ROTATE
  geom_dotplot(binwidth = "dotdensity", alpha = .5) + #ROTATE
  geom_histogram(col = "black", fill = "maroon4", alpha = .4, aes(y = ..density..)) + #ROTATE
  geom_density(linetype = "dotted", adjust = 1/4, size = 1.25) + #ROTATE
  geom_density(linetype = "dashed", adjust = 1/2, size = 1.25) + #ROTATE
  facet_grid(continent ~ .)
```

---


---
class: inverse, center, middle
name: dc

## Discrete v. Continuous

---


`r chunk_reveal("geom_discrete_continuous", break_type = "rotate")`


```{r geom_discrete_continuous, eval = F, echo = F}
gapminder %>% 
  filter(year == 2002) %>%
  mutate(higher_income = gdpPercap > 20000) %>% 
  ggplot() +
  aes(y = fct_rev(continent)) +
  aes(x = lifeExp) +
  geom_point(size = .2) + 
  geom_boxplot(alpha = .1) + #ROTATE
  geom_boxplot(width = .1, outlier.shape = NA, alpha = 0.5) + #ROTATE
  geom_jitter(width = .2, alpha = .5, color = "green") + #ROTATE
  geom_violin(alpha = .1) + #ROTATE
  ggforce::geom_sina(col = "magenta", alpha = .5) + #ROTATE
  stat_summary(fun.y = mean, geom = "point", col = "goldenrod2", size = 8) + #ROTATE
  ggridges::geom_density_ridges(alpha = .2, fill = "blue") + #ROTATE
  ggridges::geom_density_ridges(scale = .7, alpha = .2, fill = "blue") + #ROTATE
  ggridges::geom_density_ridges(scale = 1.5, alpha = .2, fill = "blue") + #ROTATE
  ggridges::geom_density_ridges_gradient(aes(fill = stat(x))) + #ROTATE
  ggridges::stat_density_ridges(quantile_lines = TRUE, quantiles = c(0.025, 0.975), alpha = 0.5, fill = "plum4") + #ROTATE
  ggridges::geom_density_ridges(jittered_points = TRUE, position = "raincloud", alpha = .5, scale = 0.9) + #ROTATE
  ggridges::geom_density_ridges(stat = "binline", bins = 20, scale = 0.95, draw_baseline = FALSE) + #ROTATE
  ggridges::geom_density_ridges(scale = 2, alpha = .5) + ggridges::scale_fill_cyclical(values = c("blue", "green")) + #ROTATE
  geom_point(aes(color = continent), position = position_nudge(x = 0, y = .2), size = .5, alpha = 0.8) + geom_boxplot(width = .1, outlier.shape = NA, alpha = 0.5) + #ROTATE
  theme_minimal() +
  labs(y = NULL)
```


---

`r chunk_reveal("geom_discrete_continuous_bee", break_type = "rotate")`

```{r geom_discrete_continuous_bee, include = F}
gapminder %>% 
  mutate(higher_income = gdpPercap > 20000) %>% 
  ggplot() +
  aes(x = continent) +
  aes(y = lifeExp) + 
  aes(alpha = year) +
  ggbeeswarm::geom_quasirandom(aes(x = continent, y = lifeExp)) + #ROTATE
  ggbeeswarm::geom_quasirandom(aes(color = continent)) + #ROTATE
  ggbeeswarm::geom_quasirandom(aes(color = higher_income), dodge.width = .8) #ROTATE
```





```{r, eval = F, echo = F}
# gapminder %>% 
#   filter(year == 2002) %>% 
#   filter(continent == "Europe") %>% 
#   mutate(to = 1) %>% 
#   select(country, to, pop) %>% 
#   rename(from = country) %>% 
#   uncount(round(pop/10000000)) %>% 
#   select(-pop) %>% 
# igraph::graph_from_data_frame(.) %>% 
# ggraph::ggraph(., layout = "treemap") + 
#   geom_node_tile(aes(fill = depth), size = 0.25)
```




---
class: inverse, center, middle
name: dd

## Discrete v. Discrete

---

`r chunk_reveal("discrete2x", break_type = "rotate")`


```{r discrete2x, eval = F, echo = F}
gapminder_2002 %>% 
  mutate(seventy_plus = lifeExp >= 75) %>% 
  mutate(age_category = 
           case_when(seventy_plus == T ~ 
                       "Seventy +",
                     seventy_plus == F ~ 
                       "< Seventy")) %>% 
  ggplot() +
  aes(x = continent) +
  aes(y = age_category) +
  geom_jitter(col = "blue", alpha = .3, width = .35, height = .35) + 
  geom_count(col = "magenta", alpha = .6) + #ROTATE
  geom_text(data = . %>% group_by(age_category, continent) %>% count, aes(label = n)) + #ROTATE
  geom_label(data = . %>% group_by(age_category, continent) %>% count, aes(label = n)) + #ROTATE
  geom_point(position = ggforce::position_jitternormal()) + #ROTATE
  geom_point(position = ggforce::position_jitternormal(sd_x = 0.15, sd_y = 0.01)) + #ROTATE
  theme_minimal()
```





---

`r chunk_reveal("discrete2x2", break_type = "rotate")`

```{r discrete2x2, eval = F, echo = F}
gapminder_2002 %>% 
  mutate(seventyfive_plus = lifeExp >= 75) %>% 
  mutate(age_category = 
           case_when(seventyfive_plus == T ~ 
                       "75+",
                     seventyfive_plus == F ~ 
                       "<75")) %>% 
  ggplot() +
  aes(x = age_category) +
  aes(fill = continent) +
  geom_point(stat = "count") +
  geom_bar(position = "dodge", alpha = .6) + #ROTATE
  geom_bar(alpha = .6) + #ROTATE
  theme_minimal()
```


---

# Mosaic


---

`r chunk_reveal("mosaic")`

```{r mosaic, eval = F, echo = F}
gapminder %>%
  filter(year == 2002) %>% 
  mutate(higher_income = gdpPercap > 20000) %>% 
  group_by(continent, higher_income) %>%
  summarise(count = n()) %>%
  mutate(num_in_continents = sum(count),
         prop = count/sum(count)) %>%
  ungroup() %>% 
  ggplot() + 
  aes(x = continent, y = prop) + 
  geom_bar(stat = "identity", 
           position = "fill",
           color = "lightgrey") +
  facet_grid(~continent, scales = "free_x", space = "free_x") +
  aes(width = num_in_continents) +
  aes(fill = higher_income) +
  theme(panel.spacing.x = unit(0, "npc")) + 
  theme(strip.text = element_blank())
```

---

# Cartography, Networks, Animation...

Are in other code-movies in the [ggplot2 grammar guide](https://evamaerey.github.io/ggplot2_grammar_guide/about).




---

<!-- --- -->
<!-- class: middle, center, inverse -->

<!-- # geom stats -->

<!-- -- -->

<!-- ### identity -->

<!-- -- -->


<!-- ### count -->


<!-- --- -->



<!-- ```{r stat, include=F} -->
<!-- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-03/game_goals.csv') -> -->
<!--   game_goals -->

<!-- game_goals %>%  -->
<!--   count(season) %>%  -->
<!--   full_join(tibble(season = 1980:2020)) %>%  -->
<!--   ggplot() + -->
<!--   aes(x = season) + -->
<!--   aes(y = n) + -->
<!--   geom_col() + # stat is identity -->
<!--   geom_point() + # stat is identity -->
<!--   geom_line() + # stat is identity -->
<!--   geom_area(alpha = .2, # stat is identity -->
<!--             fill = "magenta") + -->
<!--   aes(fill = season) + -->
<!--   aes(xend = season) +  -->
<!--   aes(yend = 0) + -->
<!--   geom_segment(linetype = "dotted") -> -->
<!-- you_aggregate_then_plot -->

<!-- game_goals %>% -->
<!--   ggplot() + -->
<!--   aes(x = season) + -->
<!--   geom_bar() + # a version of geom column -->
<!--   geom_point(stat = "count") + -->
<!--   geom_line(stat = "count") + -->
<!--   geom_area(stat = "count", -->
<!--             alpha = .2, -->
<!--             fill = "magenta") + -->
<!--   aes(fill = season) -> # not completely grasping why fill cant work here -->
<!-- ggplot_aggregates_for_you -->
<!-- ``` -->


<!-- --- -->


<!-- ```{r bar_discrete_continuous, include = F} -->
<!-- tibble(my_var = c(1, 2.5, 2.5, 2.5, -->
<!--                   7, 7.25, 7.25)) %>%  -->
<!--   ggplot() + -->
<!--   aes(x = my_var) + -->
<!--   geom_bar(fill = "blue", # default is   -->
<!--            alpha = .5, # widths adjusted so  -->
<!--            linetype = "dotted") + # no overlap -->
<!--   geom_bar(alpha = .5,  -->
<!--            width = .6, #setting width -->
<!--            fill = "orange") +  -->
<!--   # replacing previous aes x statement -->
<!--   # each category take up horizontal space of 1  -->
<!--   aes(x = as_factor(my_var))  -->
<!-- ``` -->




<!-- ## radar chart -->

<!-- ```{r} -->
<!-- gapminder %>%  -->
<!--   filter(continent == "Oceania") %>%  -->
<!--   select(year, country, gdpPercap) %>%  -->
<!--   group_by(country) %>%  -->
<!--   mutate(row = row_number()) %>%  -->
<!--   mutate(dist = row/n()) %>%  -->
<!--   mutate(y_pos = gdpPercap*sin(2*pi*dist)) %>%  -->
<!--   mutate(x_pos = gdpPercap*cos(2*pi*dist)) -> -->
<!-- prep -->

<!-- tibble(y = (1:8 * 4000)) %>%  -->
<!--   crossing(x = 1:12) %>%  -->
<!--   group_by(y) %>%  -->
<!--   mutate(row = row_number()) %>%  -->
<!--   mutate(dist = row/n()) %>%  -->
<!--   mutate(y_pos = y*sin(2*pi*dist)) %>%  -->
<!--   mutate(x_pos = y*cos(2*pi*dist)) %>%  -->
<!--   ggplot() + -->
<!--   aes(group = y) + -->
<!--   aes(x = x_pos) + -->
<!--   aes(y = y_pos) + -->
<!--   geom_path() + -->
<!--   geom_path(data = prep, aes(group = country), -->
<!--             color = "purple", -->
<!--             size = 4) -->

<!-- options(scipen = 30) -->
<!-- sin(pi*2*(1:6)/6) -->
<!-- ``` -->




```{css, eval = TRUE, echo = F}
.remark-code{line-height: 1.5; font-size: 55%}
```

